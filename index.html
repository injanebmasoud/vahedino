
<!DOCTYPE html>
<html dir="rtl" lang="fa">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="viewport" content="width=1200">
        <meta name="viewport" content="width=1200">
        <!-- Primary Meta Tags -->
        <meta name="title" content="واحدینو | برنامه هفتگی دانشگاه خواجه نصیر">
        <meta name="description"
            content="برنامه ریزی آسان دروس دانشگاه خواجه نصیر با واحدینو - مشاهده تداخل‌های زمانی و امتحانی، دریافت برنامه هفتگی و مدیریت هوشمند انتخاب واحد">
        <meta name="keywords"
            content="واحدینو, برنامه هفتگی خواجه نصیر, انتخاب واحد خواجه نصیر, دانشگاه خواجه نصیر, برنامه ریزی دروس, تداخل دروس, برنامه امتحانات">

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://vahedino.ir">
        <meta property="og:title"
            content="واحدینو | برنامه هفتگی دانشگاه خواجه نصیر">
        <meta property="og:description"
            content="برنامه ریزی آسان دروس دانشگاه خواجه نصیر با واحدینو - مشاهده تداخل‌های زمانی و امتحانی، دریافت برنامه هفتگی و مدیریت هوشمند انتخاب واحد">
        <meta property="og:image" content="https://vahedino.ir/og-image.jpg">

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://vahedino.ir">
        <meta property="twitter:title"
            content="واحدینو | برنامه هفتگی دانشگاه خواجه نصیر">
        <meta property="twitter:description"
            content="برنامه ریزی آسان دروس دانشگاه خواجه نصیر با واحدینو - مشاهده تداخل‌های زمانی و امتحانی، دریافت برنامه هفتگی و مدیریت هوشمند انتخاب واحد">
        <meta property="twitter:image"
            content="https://vahedino.ir/twitter-image.jpg">

        <!-- Additional SEO Tags -->
        <meta name="robots" content="index, follow">
        <meta name="language" content="fa">
        <meta name="author" content="انجمن علمی نقشه برداری دانشگاه خواجه نصیر">
        <link rel="canonical" href="https://vahedino.ir">

        <meta charset="UTF-8">
        <meta name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>واحدینو | دستیار انتخاب واحد دانشگاه خواجه نصیر</title>
        <meta name="description"
            content="واحدینو، دستیار هوشمند انتخاب واحد دانشگاه خواجه نصیر. برنامه ریزی آسان دروس، مشاهده تداخل‌های زمانی و امتحانی، دریافت برنامه هفتگی">
        <meta name="keywords"
            content="واحدینو, انتخاب واحد, دانشگاه خواجه نصیر, برنامه هفتگی, برنامه ریزی دروس, تداخل دروس, برنامه امتحانات">

        <!-- Open Graph Tags -->
        <meta property="og:title"
            content="واحدینو | دستیار انتخاب واحد دانشگاه خواجه نصیر">
        <meta property="og:description"
            content="برنامه ریزی آسان دروس دانشگاه خواجه نصیر با واحدینو">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://vahedino.ir">

        <!-- Twitter Card Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title"
            content="واحدینو | دستیار انتخاب واحد خواجه نصیر">
        <meta name="twitter:description"
            content="برنامه ریزی آسان دروس دانشگاه خواجه نصیر">

        <!-- Additional SEO Tags -->
        <meta name="robots" content="index, follow">
        <meta name="language" content="fa">
        <meta name="author" content="انجمن علمی نقشه برداری">
        <link rel="canonical" href="https://vahedino.ir">

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="favicon.ico">
    </head>

    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>واحدینو | برنامه هفتگی</title>
        <style>
            @media screen and (max-width: 1200px) {
            body {
                transform-origin: top left;
                transform: scale(var(--scale-factor));
                width: 1200px;
            }
        }
            @media screen and (max-width: 1200px) {
    body {
        transform-origin: top left;
        transform: scale(var(--scale-factor));
        width: 1200px;
    }
}


            :root {
    --scale-factor: 1;
}


        @font-face {
            font-family: "IRANSans";
            src: url("IRANSansWeb(FaNum).woff2");
        }
        *{
            font-family: "IRANSans";
        }
        @media screen and (max-width: 1200px) {
    body {
        transform-origin: top left;
        transform: scale(var(--scale-factor));
        width: 1200px;
    }
}
        @media screen and (max-width: 1200px) {
    body {
        transform-origin: top left;
        transform: scale(var(--scale-factor));
        width: 1200px;
    }
}


        body {
            background: #121212;
            color: white;
            font-family: "IRANSans";
            margin: 0;
            padding: 20px;
            width: 1200px;
            height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            margin-left: auto;
            margin-right: auto;
        }
        .navbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 8px 16px;
            font-size: 15px;
            background: #121212;
            border: none;
            color: rgb(217, 217, 217);
            border-radius: 4px;
            cursor: pointer;
        }
        
        .tab1{
            padding: 8px 16px;
            font-size: 30px;
            background: #121212;
            border: none;
            color: rgb(255, 255, 255);
            border-radius: 4px;
            cursor: pointer;
        }
        .tab.active {
            background: #121212;
        }
        .container {
            display: flex;
            gap: 20px;
            width: 1200px;
            margin: auto;
            overflow-x: hidden;
        }
        .course-notes {
    color: #c4c4c4;
    font-size: 0.85em;
    display: block;
    margin-top: 4px;
    line-height: 1.4;
}

        .container {
    display: flex;
    gap: 20px;
    width: 1200px;
    margin: auto;
    padding: 20px;
}

.course-notes {
    font-size: 0.9em;
    color: #c4c4c4;
    display: block;
    margin-top: 4px;
}


.sidebar {
    width: 300px;
    background: #121212;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.schedule {
    flex: 1;
    background: #121212;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.course {
    background: #88909700;
    color: white;
    padding: 15px;
    margin: 8px 0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.course:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    opacity: 0.95;
}

.course-notes {
    color: #aaa;
    font-size: 0.9em;
    display: block;
    margin-top: 4px;
}

table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 8px;
    overflow: hidden;
}

th {
    background: #88909700;
    color: white;
    padding: 12px;
    font-weight: 500;
}

td {
    position: relative;
    height: 40px;
    background: rgba(136, 144, 151, 0.1);
    padding: 12px;
    border: 1px solid rgba(136, 144, 151, 0.2);
}
.selected-course {
    background: #ff5722;
    color: white;
    padding: 5px;
    border-radius: 4px;
    margin: 2px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    position: absolute;
    width: calc(100% - 14px);
    z-index: 1;
    box-sizing: border-box;
}

td {
    position: relative;
    height: 60px;
    vertical-align: top;
    padding: 4px;
}
.selected-course {
    position: absolute;
    width: calc(100% - 10px);
    background: #ff5722;
    z-index: 1;
    font-size: 12px;
    line-height: 1.2;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}

td {
    position: relative;
    min-height: 80px;
    padding: 5px;
    box-sizing: border-box;
}

.selected-course {
    position: absolute;
    width: calc(100% - 10px);
    background: #ff5722;
    z-index: 1;
    top: 0;
    left: 5px;
    right: 5px;
    margin: 0;
    padding: 4px;
    font-size: 12px;
    line-height: 1.2;
}

td {
    position: relative;
    height: 60px;
    padding: 5px;
    box-sizing: border-box;
    vertical-align: top;
}

.remove-course {
    background: transparent;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
    padding: 0 4px;
}

.selected-course {
    position: absolute;
    width: calc(100% - 10px);
    background: #ff5722;
    z-index: 1;

    background: #889097;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    margin: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

        .sidebar {
            width: 300px;
            overflow-y: auto;
            max-height: calc(100vh - 100px);
            scrollbar-width: thin;
            scrollbar-color: #00b894 #121212;
        }
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #121212;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background-color: #00b894;
            border-radius: 10px;
            border: 2px solid #121212;
        }
        .department-select, .search-box {
            text-align: right;
            margin-bottom: 15px;
            padding: 10px;
            border: 2px solid #00b894;
            border-radius: 8px;
            width: calc(100% - 20px);
            box-sizing: border-box;
            background: #121212;
            color: white;
        }
        .department-select:focus, .search-box:focus {
            outline: none;
            border-color: #ff5722;
        }
        .course {
            background: #121212;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
        }
        .schedule {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #121212;
            padding: 8px;
            text-align: center;
            vertical-align: top;
        }
        .selected-course {
            background: #ff5722;
            color: white;
            padding: 5px;
            border-radius: 4px;
            margin: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-course {
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        .course {
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.course-header {
    margin-bottom: 8px;
}

.course-details {
    font-size: 0.9em;
    color: #e0e0e0;
}

.course-sessions {
    margin: 8px 0;
}

.course-notes {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.85em;
    color: #aaa;
}

        @media (max-width: 1200px) {
            body, .container {
                overflow-x: auto;
                width: 1200px;
            }
        }
        .dis{
            color: rgb(174, 174, 174);
        }
        .department-select {
    scrollbar-width: thin;
    scrollbar-color: #00b894 #121212;
}

.department-select::-webkit-scrollbar {
    width: 10px;
}

.department-select::-webkit-scrollbar-track {
    background: #121212;
    border-radius: 10px;
}

.department-select::-webkit-scrollbar-thumb {
    background-color: #00b894;
    border-radius: 10px;
    border: 3px solid #121212;
}

.department-select::-webkit-scrollbar-thumb:hover {
    background-color: #00D890;
}
.download-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #889097;
    color: white;
    border: none;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
    z-index: 1000;
}

.download-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    background: #7a838a;
}
table th:nth-child(2), 
table td:nth-child(2) {
    width: 16%;
}


.department-select {
    max-height: 300px;
    overflow-y: auto;
    text-align-last: right;
}

.department-select option {
    background-color: #121212;
    color: white;
    padding: 5px;
    margin: 2px 0;
}

.department-select option:checked {
    background-color: #00b894;
    color: #121212;
}
.sidebar {
    position: relative;
}

.search-controls {
    position: sticky;
    top: 0;
    background: #121212;
    padding: 15px;
    z-index: 10;
}
.download-button {
    position: fixed;
    bottom: 30px;
    left: 30px;
    background: #889097;
    color: white;
    border: none;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
    z-index: 1000;
}

.download-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    background: #7a838a;
}


.course {
    background: #2c2c2c;
}

.download-button {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: #00D890;
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
}

.download-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.dl {
    position: fixed !important;
    bottom: 30px !important;
    left: 30px !important;   /* حتماً override کن */
    right: auto !important; /* از سمت راست حذف شه */
    background: #00b894;
    color: white;
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
    z-index: 1000;
    font-size: 14px;
}


.dl:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.3);
    background: #00b894;
}

.dl {
    position: fixed;
    bottom: clamp(15px, 3vw, 30px);
    right: clamp(15px, 3vw, 30px);
    background: #00D890;
    color: white;
    border: none;
    border-radius: clamp(8px, 2vw, 12px);
    padding: clamp(8px, 2vw, 12px) clamp(16px, 3vw, 24px);
    display: flex;
    align-items: center;
    gap: clamp(4px, 1vw, 8px);
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
    z-index: 1000;
    font-size: clamp(12px, 1.5vw, 14px);
}
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    margin-bottom: 20px;
    background: linear-gradient(180deg, #1d1d1d 0%, rgba(13, 59, 102, 0) 100%);
    border-radius: 15px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 8px;
}

.nav-menu {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.nav-item {
    color: var(--text-color);
    text-decoration: none;
    padding: 8px 16px;
    position: relative;
}

.social-icons a {
    transition: transform 0.2s ease;
}

.social-icons a:hover {
    transform: translateY(-2px);
}


.dl svg {
    width: clamp(16px, 2vw, 20px);
    height: clamp(16px, 2vw, 20px);
}

@media screen and (max-width: 768px) {
    .dl {
        padding: 8px 16px;
        font-size: 12px;
    }
    
    .dl svg {
        width: 16px;
        height: 16px;
    }
}
.nav-menu a[href="/summary/index.html"]::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: #00D890;
}

.nav-menu a[href="index.html"]::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: #00D890;
}
.nav-menu {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
}

.nav-item {
    color: white;
    text-decoration: none;
    padding: 8px 16px;
    font-size: 16px;
    position: relative;
}

.nav-item:hover {
    opacity: 0.8;
}
.nav-menu a[href="index.html"]::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: #00D890;
}
.nav-menu a[href="kholase.html"]::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: #00D890;
}

.dl svg {
    width: 20px;
    height: 20px;
}

    </style>
    </head>
    <header class="header">
        <div class="logo">
            <span style="font-size: 24px;">واحدینو</span>
            <span style="font-size: 14px; color: #c4c4c4;">(نسخه بتا)</span>
        </div>
        <div class="nav-menu">
            <a href="../" class="nav-item">برنامه هفتگی</a>
            <a href="../summary/" class="nav-item">خلاصه وضعیت</a>
        </div>
        <div class="social-icons">
            <a href="https://t.me/vahedino" target="_blank" style="color: #ffffff; text-decoration: none; display: flex; align-items: center; gap: 4px; font-size: 14px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
                تلگرام
            </a>
            <!--<a href="https://github.com/vahedino" target="_blank" style="color: #ffffff; text-decoration: none; display: flex; align-items: center; gap: 4px; font-size: 14px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
                گیت‌هاب
            </a>-->
        </div>
    </header>
    

    <body>
        <!--<div class="navbar">
            <button class="tab1 active"
                onclick="switchProgram(1)">واحدینو</button>
            <button class="tab" id="addProgramButton"
                onclick="addNewProgram()">(نسخه بتا)</button>
    </div>
    
        
    <p class="dis">دستیار انتخاب واحد خواجه نصیر</p><br>-->

        <div class="container">
            <div class="sidebar">
                <select id="departmentSelect" class="department-select"
                    onchange="filterCoursesByDepartment()">
                    <option value>کلیه دانشکده ها</option>
                    <option value="مهندسی نقشه برداری">مهندسي نقشه
                        برداري</option>
                    <option value="مهندسی عمران">مهندسي عمران</option>
                    <option value="مهندسی کامپیوتر">مهندسي کامپیوتر</option>
                    <option value="مهندسی برق">مهندسي برق</option>
                    <option value="مهندسی هوافضا">مهندسي هوافضا</option>
                    <option value="مهندسی مکانیک">مهندسي مکانیک</option>
                    <option value="مهندسی صنایع">مهندسی صنایع</option>
                    <option value="مهندسی و علم مواد">مهندسی علم و مواد</option>
                    <option value="فیزیک"> فيزيك</option>
                    <option value="دانشكده رياضي"> ریاضی</option>
                    <option value="شیمی"> شیمی</option>
                    <option value="مركز آموزش هاي عمومي">مركز آموزش هاي
                        عمومي</option>

                </select>

                <input type="text" id="searchBox" class="search-box"
                    placeholder="جستجوی درس..." oninput="filterCourses()">
                <div
                    style="background: #181818; padding: 15px; margin-bottom: 15px; border-radius: 4px;">
                    تعداد واحد: <span id="units">0</span>
                </div>
                <div id="courseList"></div>
            </div>

            <div class="schedule">
                <table>
                    <tr>
                        <th>ساعت</th>
                        <th>شنبه</th>
                        <th>یکشنبه</th>
                        <th>دوشنبه</th>
                        <th>سه‌شنبه</th>
                        <th>چهارشنبه</th>
                        <th>پنجشنبه</th>
                    </tr>
                    <tbody id="scheduleBody"></tbody>

                </table>
                <button onclick="downloadSchedule()" class="dl">
                    <svg width="24" height="24" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                    </svg>
                </button>
            </div>

        </div>

        <!--<p>میدونیم هنوز تا بهتر شدن خیلی فاصله داریم ولی داریم سعی خودمون رو
            میکنیم تا شما تجربه بهتری از این برنامه داشته باشید! </p>-->
        <p>© ساخته شده با 💚 توسط گروه توسعه فناوری <a style="text-decoration: none;color:#00D890;" href="https://Nasirino.ir"> نصیرینو</a></p><br>
        <script src="list.js"></script>
        
        <script>
        function setViewport() {
    const meta = document.querySelector('meta[name="viewport"]');
    meta.setAttribute('content', 'width=1200');
}

window.addEventListener('load', setViewport);

       


        let programs = JSON.parse(localStorage.getItem('programs')) || [{id: 1, selectedCourses: []}];
        let currentProgramId = 1;

        function formatTime(time) {
            const hours = Math.floor(time);
            const minutes = time % 1 === 0 ? '00' : '30';
            return `${hours}:${minutes}`;
        }

        function initSchedule() {
            const scheduleBody = document.getElementById('scheduleBody');
            scheduleBody.innerHTML = '';

            const allHours = [7.5, 9, 10.5, 12, 13.5, 15, 16.5, 18];

            allHours.forEach(hour => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatTime(hour)}</td>
                    ${Array(6).fill('<td></td>').join('')}
                `;
                scheduleBody.appendChild(row);
            });

            filterCoursesByDepartment();
            updateSchedule();
            updateUnits();
        }
        function selectCourse(course) {
    const currentProgram = programs.find(p => p.id === currentProgramId);
    const totalUnits = currentProgram.selectedCourses.reduce((sum, c) => sum + c.units, 0);

    // Check if course is already selected
    if (currentProgram.selectedCourses.some(c => c.code === course.code)) {
        alert('این درس قبلاً انتخاب شده است');
        return;
    }

    // Check total units
    if (totalUnits + course.units > 24) {
        alert('مجموع واحدها نمی‌تواند بیشتر از ۲۴ باشد');
        return;
    }

    // Check time conflicts
    const conflictingCourse = currentProgram.selectedCourses.find(selectedCourse => {
        return selectedCourse.sessions.some(selectedSession => {
            return course.sessions.some(newSession => {
                return selectedSession.days.some(selectedDay => {
                    return newSession.days.includes(selectedDay) && 
                           !(newSession.start >= (selectedSession.start + selectedSession.duration) || 
                             (newSession.start + newSession.duration) <= selectedSession.start);
                });
            });
        });
    });

    if (conflictingCourse) {
        alert(`تداخل زمانی با درس ${conflictingCourse.name}`);
        return;
    }

    // Add course if all checks pass
    currentProgram.selectedCourses.push(course);
    updateSchedule();
    updateUnits();
    saveToLocalStorage();
}
// Add this to handle course data updates
function syncSelectedCourses() {
    // Get all programs
    programs = JSON.parse(localStorage.getItem('programs')) || [{id: 1, selectedCourses: []}];
    
    // Update each program's courses
    programs = programs.map(program => {
        program.selectedCourses = program.selectedCourses.map(selectedCourse => {
            // Get fresh data from courses array
            const freshCourse = courses.find(c => c.code === selectedCourse.code);
            if (freshCourse) {
                return {
                    ...freshCourse,
                    sessions: freshCourse.sessions
                };
            }
            return selectedCourse;
        });
        return program;
    });

    // Save updated data
    localStorage.setItem('programs', JSON.stringify(programs));
    
    // Refresh display
    updateSchedule();
    filterCoursesByDepartment();
}

// Call this after modifying courses array
// Add this function to handle automatic course updates
function autoUpdateCourses() {
    const currentProgram = programs.find(p => p.id === currentProgramId);
    
    // Update each selected course with latest data
    currentProgram.selectedCourses = currentProgram.selectedCourses.map(selectedCourse => {
        const updatedCourse = courses.find(c => c.code === selectedCourse.code);
        return updatedCourse || selectedCourse;
    });

    // Update storage and display
    localStorage.setItem('programs', JSON.stringify(programs));
    updateSchedule();
}

// Call this function after modifying course data
function refreshSchedule() {
    autoUpdateCourses();
    filterCoursesByDepartment();
}
// Add this function to sync course data
function syncCourses() {
    // Get current program
    let currentProgram = programs.find(p => p.id === currentProgramId);
    
    // Update selected courses with fresh data
    if (currentProgram && currentProgram.selectedCourses) {
        currentProgram.selectedCourses = currentProgram.selectedCourses.map(selectedCourse => {
            // Find matching course from master list
            const freshData = courses.find(c => c.code === selectedCourse.code);
            if (freshData) {
                return {
                    ...freshData,
                    id: selectedCourse.id // Preserve original ID
                };
            }
            return selectedCourse;
        });
    }

    // Save changes
    localStorage.setItem('programs', JSON.stringify(programs));
    
    // Refresh display
    updateSchedule();
    filterCoursesByDepartment();
}

// Call this after updating courses array
function refreshAll() {
    syncCourses();
}



      
        function removeCourseById(courseId) {
            const currentProgram = programs.find(p => p.id === currentProgramId);
            currentProgram.selectedCourses = currentProgram.selectedCourses.filter(c => c.id !== courseId);
            
            updateSchedule();
            updateUnits();
            saveToLocalStorage();
        }
        function updateSchedule() {
    document.querySelectorAll('td').forEach(td => {
        if (!/\d+:\d+/.test(td.textContent)) td.innerHTML = '';
    });

    const currentProgram = programs.find(p => p.id === currentProgramId);
    currentProgram.selectedCourses.forEach(course => {
        if (course.sessions) {
            // برای دروس چند جلسه‌ای
            course.sessions.forEach(session => {
                session.days.forEach(day => {
                    const rowIndex = Array.from(document.querySelectorAll('#scheduleBody tr')).findIndex(
                        row => row.querySelector('td').textContent === formatTime(session.start)
                    );
                    if (rowIndex !== -1) {
                        const row = document.querySelector(`#scheduleBody tr:nth-child(${rowIndex + 1})`);
                        const cell = row.children[day];
                        const heightInRows = Math.ceil(session.duration / 1.5);
                        cell.innerHTML += `
                            <div class="selected-course" style="height: ${heightInRows * 100}%">
                                <span>${course.name} (${course.code})<br>${course.prof}</span>
                                <button class="remove-course" onclick="removeCourseById(${course.id})">&times;</button>
                            </div>
                        `;
                    }
                });
            });
        } else {
            // برای دروس تک جلسه‌ای (ساختار قبلی)
            course.days.forEach(day => {
                const rowIndex = Array.from(document.querySelectorAll('#scheduleBody tr')).findIndex(
                    row => row.querySelector('td').textContent === formatTime(course.start)
                );
                if (rowIndex !== -1) {
                    const row = document.querySelector(`#scheduleBody tr:nth-child(${rowIndex + 1})`);
                    const cell = row.children[day];
                    const heightInRows = Math.ceil(course.duration / 1.5);
                    cell.innerHTML += `
                        <div class="selected-course" style="height: ${heightInRows * 100}%">
                            <span>${course.name} (${course.code})<br>${course.prof}</span>
                            <button class="remove-course" onclick="removeCourseById(${course.id})">&times;</button>
                        </div>
                    `;
                }
            });
        }
    });
}

        function updateUnits() {
            const currentProgram = programs.find(p => p.id === currentProgramId);
            const total = currentProgram.selectedCourses.reduce((sum, course) => sum + course.units, 0);
            document.getElementById('units').textContent = total;
        }

        

        
function saveToLocalStorage() {
    localStorage.setItem('programs', JSON.stringify(programs));
}

// Add gender property to course display
function filterCoursesByDepartment() {
    const departmentSelect = document.getElementById('departmentSelect');
    const selectedDepartment = departmentSelect.value;
    const searchTerm = document.getElementById('searchBox').value.toLowerCase();
    const courseList = document.getElementById('courseList');
    courseList.innerHTML = '';

    courses
        .filter(course => 
            (selectedDepartment === '' || course.department === selectedDepartment) &&
            (course.name.toLowerCase().includes(searchTerm) || course.code.toLowerCase().includes(searchTerm))
        )
        .forEach(course => {
            const div = document.createElement('div');
            div.className = 'course';
            
            // Enhanced course information display including notes
            div.innerHTML = `
                <div class="course-header">
                    <strong>${course.name}</strong> (${course.code})
                </div>
                <div class="course-details">
                    <div>استاد: ${course.prof}</div>
                    <div>واحد: ${course.units}</div>
                    <div>دانشکده: ${course.department}</div>
                    <div>زمان امتحان: ${course.examDate}</div>
                    <div class="course-sessions">
                        ${course.sessions.map(session => 
                            `${session.location}<br>
                             ${session.days.map(day => ['شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه'][day-1]).join(', ')}
                             ${formatTime(session.start)}-${formatTime(session.start + session.duration)}`
                        ).join('<br>')}
                    </div>
                    <div class="course-notes">
                        ظرفیت: ${course.capacity} نفر
                        ${course.gender ? `<br>جنسیت: ${course.gender}` : ''}
                    </div>
                </div>
            `;
            
            div.onclick = () => selectCourse(course);
            courseList.appendChild(div);
        });
}

function filterCourses() {
    const searchTerm = document.getElementById('searchBox').value.trim().toLowerCase();
    const departmentSelect = document.getElementById('departmentSelect');
    const selectedDepartment = departmentSelect.value;
    const courseList = document.getElementById('courseList');
    courseList.innerHTML = '';

    const searchParts = searchTerm.split(/\s+/);

    const filteredCourses = courses.filter(course => {
        if (selectedDepartment && course.department !== selectedDepartment) {
            return false;
        }

        if (!searchTerm) {
            return true;
        }

        const searchableText = [
            course.name,
            course.code,
            course.prof,
            course.department
        ].join(' ').toLowerCase();

        return searchParts.some(part => searchableText.includes(part));
    });

    filteredCourses.forEach(course => {
        const div = document.createElement('div');
        div.className = 'course';
        div.innerHTML = `${course.name} (${course.code})<br>${course.prof}<br>${course.units} واحد<br>${course.department}`;
        div.onclick = () => selectCourse(course);
        courseList.appendChild(div);
    });
}


function switchProgram(programId) {
    currentProgramId = programId;
    updateSchedule();
    updateUnits();
}

function addNewProgram() {
    const newProgramId = programs.length > 0 ? Math.max(...programs.map(p => p.id)) + 1 : 1;
    const newProgram = { id: newProgramId, selectedCourses: [] };
    programs.push(newProgram);
    
    // Update tabs
    const addProgramButton = document.getElementById('addProgramButton');
    const navbarElement = addProgramButton.parentElement;
    
    const newProgramTab = document.createElement('button');
    newProgramTab.className = 'tab';
    newProgramTab.textContent = `برنامه ${newProgramId}`;
    newProgramTab.onclick = () => switchProgram(newProgramId);
    
    navbarElement.insertBefore(newProgramTab, addProgramButton);
    
    // Switch to new program
    switchProgram(newProgramId);
    saveToLocalStorage();
}

// Initialize the first program and schedule
initSchedule();
function downloadSchedule() {
    const scheduleElement = document.querySelector('.schedule');
    
    html2canvas(scheduleElement, {
        backgroundColor: '#051d33',
        scale: 2,
        useCORS: true,
        logging: false,
        width: scheduleElement.offsetWidth,
        height: scheduleElement.offsetHeight
    }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'vahedino-schedule.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
}

</script>
        <script
            src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    </body>
    <script src="script.js"></script>

</html>
